<%- model_class = Bot.new.class -%>
<% @user = params[:user_id] ? User.find(params[:user_id]) : current_user %>

<script>
  $(document).ready(function(){
    user_id = <%= @user.id %>;
    get_status();
    setInterval('get_status()', get_status_interval);
  });
</script>

<h1><%= raw("#{t('.title', :default => model_class.model_name.human.pluralize)} (#{link_to @user.name, @user})")%> </h1>

<% unless @bots.empty? %>
  <%= will_paginate @bots %>

  <table class="table table-striped table-bordered centered">
    <thead>
      <tr>
        <th>#</th>
        <th><%= model_class.human_attribute_name(:email) %></th>
        <th><%= model_class.human_attribute_name(:bot_type) %></th>
        <th><%= model_class.human_attribute_name(:page) %></th>
        <th><%= model_class.human_attribute_name(:count) %></th>
        <th><%= model_class.human_attribute_name(:interval) %></th>
        <th><%= model_class.human_attribute_name(:created_at) %></th>
        <th><%= model_class.human_attribute_name(:status) %></th>
        <th><%=t '.actions', :default => t("helpers.actions") %></th>
      </tr>
    </thead>
    <tbody>
      <% @bots.each do |bot| %>
        <tr>
          <td><%= bot.id %></td>
          <td><%= bot.email %></td>
          <td><span class="label"><%= bot.bot_type %></span></td>
          <td><%= link_to bot.page_title.nil? || bot.page_title.empty? ? 'N/A' : bot.page_title, bot.page, :id => "link_title_#{bot.id}" %></td>
          <td><span class="badge badge-info"><%= bot.count %></span></td>
          <td><span class="badge badge-info"><%= bot.interval %></span></td>
          <td><%= bot.created_at.strftime("%d/%m/%Y") %></td>
          <td><span id="status_<%= bot.id %>" name="bot_status" class="label">N/A</span></td>
          <td class='bots_list_control left'>
            <% if current_user?(@user) || current_user.admin? && !@user.admin? %>
              <%= link_to 'Run',
                          '#',
                          :onclick => 'run(' + bot.id.to_s + '); return false;',
                          :class => 'btn btn-mini btn-success',
                          :id => 'bot_' + bot.id.to_s + '_btn',
                          :name => 'bot_btn' %>
              <%= link_to raw("<i class='icon-eye-open'></i> #{t('.view', :default => t("helpers.links.view"))}"),
                          bot_path(bot), :class => 'btn btn-mini' %>
              <%= link_to raw("<i class='icon-pencil'></i> #{t('.edit', :default => t("helpers.links.edit"))}"),
                          edit_bot_path(bot), :class => 'btn btn-mini' %>
              <%= link_to raw("<i class='icon-trash'></i> #{t('.destroy', :default => t("helpers.links.destroy"))}"),
                          bot_path(bot),
                          :method => :delete,
                          :confirm => t("helpers.links.confirm", :default => 'Are you sure?'),
                          :class => 'btn btn-mini btn-danger' %>
            <% end %>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>

  <%= will_paginate @bots %>
<% end %>

<% if @user && !@user.admin? && current_user.admin? || current_user?(@user) %>
  <% unless @bots.empty? %>
    <%= link_to 'Run All',
                '#',
                :onclick => 'run_all(); return false;',
                :class => 'btn btn-success',
                :id => 'run_all_btn' %>
    <%= link_to 'Stop All',
                '#',
                :onclick => 'stop_all(); return false;',
                :class => 'btn btn-danger',
                :id => 'stop_all_btn' %>
  <% end %>

  <%= link_to t('.new', :default => t("helpers.links.new")),
            new_user_bot_path(@user),
            :class => 'btn btn-primary' %>
<% end %>